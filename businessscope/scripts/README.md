# Scripts ç›®å½•åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ è„šæœ¬åˆ†ç±»ä¸åŠŸèƒ½è¯´æ˜

### ğŸ—‚ï¸ æ•°æ®åº“ç®¡ç†ç±» (ä¿ç•™ - æ ¸å¿ƒå·¥å…·)

#### `db-manager.js` â­ ä¸»åŠ›å·¥å…·
**åŠŸèƒ½**: ç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œå…¥å£ï¼Œè§£å†³ç¯å¢ƒå˜é‡å’Œè¿æ¥é—®é¢˜
**ä½¿ç”¨æ–¹å¼**: 
```bash
npm run db:push      # æ¨é€schemaå˜æ›´
npm run db:generate  # ç”ŸæˆPrismaå®¢æˆ·ç«¯
npm run db:verify    # éªŒè¯schemaçŠ¶æ€
npm run db:sync      # æ‰‹åŠ¨åŒæ­¥schema
npm run db:deploy    # å®Œæ•´éƒ¨ç½²æµç¨‹
```
**ç‰¹ç‚¹**:
- æ™ºèƒ½fallbackæœºåˆ¶ï¼ˆæ¨é€å¤±è´¥æ—¶è‡ªåŠ¨æ‰‹åŠ¨åŒæ­¥ï¼‰
- å®Œæ•´çš„éƒ¨ç½²æµç¨‹éªŒè¯
- ç¯å¢ƒå˜é‡è‡ªåŠ¨åŠ è½½

#### `schema-manager.js` â­ Schemaç®¡ç†ä¸“å®¶
**åŠŸèƒ½**: æä¾›schemaæ¯”è¾ƒã€åŒæ­¥ã€å¤‡ä»½ç­‰é«˜çº§åŠŸèƒ½
**ä½¿ç”¨æ–¹å¼**:
```bash
node scripts/schema-manager.js snapshot  # ç”Ÿæˆschemaå¿«ç…§
node scripts/schema-manager.js compare   # æ¯”è¾ƒschemaå·®å¼‚
node scripts/schema-manager.js fix       # è‡ªåŠ¨ä¿®å¤schema
node scripts/schema-manager.js health    # æ•°æ®åº“å¥åº·æ£€æŸ¥
```
**ç‰¹ç‚¹**:
- Schemaç‰ˆæœ¬ç®¡ç†å’Œå¿«ç…§
- è‡ªåŠ¨å·®å¼‚æ£€æµ‹å’Œä¿®å¤
- æ•°æ®åº“å¥åº·æ£€æŸ¥

#### `add-lock-fields.js` (å•æ¬¡ä½¿ç”¨ï¼Œå·²å®Œæˆ)
**åŠŸèƒ½**: æ·»åŠ ç”¨æˆ·è´¦æˆ·é”å®šç›¸å…³å­—æ®µ
**å­—æ®µ**: login_failed_count, locked_at, lock_until
**çŠ¶æ€**: å·²æ‰§è¡Œå®Œæˆï¼Œæ— éœ€å†æ¬¡è¿è¡Œ

---

### ğŸ§ª è¿æ¥æµ‹è¯•ç±»

#### `test-connections.ts` â­ æ¨èä½¿ç”¨
**åŠŸèƒ½**: å…¨é¢æµ‹è¯•PostgreSQLå’ŒRedisè¿æ¥
**æµ‹è¯•å†…å®¹**:
- PostgreSQLæ•°æ®åº“è¿æ¥å’ŒåŸºæœ¬æ“ä½œ
- Upstash Redis (REST API) è¿æ¥æµ‹è¯•
- IORedis (TCP) è¿æ¥æµ‹è¯•
**ä½¿ç”¨**: `npm run test:connections`

#### ğŸ—‘ï¸ å»ºè®®åˆ é™¤çš„é‡å¤è„šæœ¬:
- `test-db-connection.js` - åŠŸèƒ½è¢«`test-connections.ts`è¦†ç›–
- `test-db.js` - ä½¿ç”¨åŸç”Ÿpgå®¢æˆ·ç«¯ï¼Œè¿‡æ—¶
- `test-prisma.ts` - åŠŸèƒ½é‡å¤
- `test-redis.js` - åŠŸèƒ½é‡å¤

---

### ğŸ” éªŒè¯æ£€æŸ¥ç±»

#### `verify-db-tables.ts` â­ ä¿ç•™
**åŠŸèƒ½**: éªŒè¯æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´æ€§
**æ£€æŸ¥å†…å®¹**:
- æ ¸å¿ƒè¡¨æ˜¯å¦å­˜åœ¨ (raw_content, ai_analysis, usersç­‰)
- åŸºæœ¬æŸ¥è¯¢æ“ä½œæµ‹è¯•
**ä½¿ç”¨**: æ‰‹åŠ¨è¿è¡Œ `tsx scripts/verify-db-tables.ts`

#### `final-verification.js` â­ ä¿ç•™
**åŠŸèƒ½**: è®¤è¯ç³»ç»Ÿå®‰å…¨æ€§æœ€ç»ˆéªŒè¯
**éªŒè¯å†…å®¹**:
- ç”¨æˆ·è¡¨ç»“æ„å®Œæ•´æ€§
- å®‰å…¨å­—æ®µå­˜åœ¨æ€§
- è®¤è¯ç³»ç»ŸåŠŸèƒ½æ¸…å•ç¡®è®¤
**ä½¿ç”¨**: `node scripts/final-verification.js`

#### ğŸ—‘ï¸ å»ºè®®åˆ é™¤çš„é‡å¤è„šæœ¬:
- `check-tables.js` - åŠŸèƒ½å·²è¢«`schema-manager.js`è¦†ç›–
- `check-user-table.js` - è¿‡äºå…·ä½“ï¼ŒåŠŸèƒ½é‡å¤

---

### ğŸ¯ åŠŸèƒ½æµ‹è¯•ç±» (å…¨éƒ¨ä¿ç•™)

#### `test-db-operations.ts` â­ æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
**åŠŸèƒ½**: æµ‹è¯•DatabaseServiceç±»ä¸­çš„å„ç§æ–¹æ³•
**æµ‹è¯•å†…å®¹**:
- æ•°æ®åº“å¥åº·æ£€æŸ¥
- æœºä¼šåˆ—è¡¨è·å–å’Œåˆ†é¡µ
- å¹³å°ç»Ÿè®¡å’Œè¯„åˆ†åˆ†å¸ƒ
- ä»ªè¡¨æ¿ç»Ÿè®¡
- ç­›é€‰åŠŸèƒ½
**ä½¿ç”¨**: `npm run test:db`

#### `test-create-data.ts` â­ æµ‹è¯•æ•°æ®ç”Ÿæˆ
**åŠŸèƒ½**: åˆ›å»ºæµ‹è¯•æ•°æ®æ¥éªŒè¯æ•°æ®åº“æ“ä½œ
**åˆ›å»ºå†…å®¹**:
- æµ‹è¯•ç”¨æˆ·
- æµ‹è¯•åŸå§‹å†…å®¹ (Twitter, Reddit, HackerNews, ProductHunt)
- AIåˆ†æç»“æœ
- ç”¨æˆ·æ”¶è—
**ä½¿ç”¨**: æ‰‹åŠ¨è¿è¡Œ `tsx scripts/test-create-data.ts`

#### `test-webhook.js` â­ APIåŠŸèƒ½æµ‹è¯•
**åŠŸèƒ½**: æµ‹è¯• /api/webhooks/n8n æ¥å£åŠŸèƒ½
**æµ‹è¯•åœºæ™¯**:
- å¥åº·æ£€æŸ¥
- æœ‰æ•ˆæ•°æ®å¤„ç†
- æ— æ•ˆæ•°æ®éªŒè¯
- å®‰å…¨éªŒè¯
- JSONæ ¼å¼éªŒè¯
**ä½¿ç”¨**: `node scripts/test-webhook.js`

#### `verify-webhook-data.ts` â­ æ•°æ®éªŒè¯
**åŠŸèƒ½**: éªŒè¯Webhookæ•°æ®æ’å…¥æƒ…å†µ
**éªŒè¯å†…å®¹**:
- æ•°æ®æ’å…¥çŠ¶æ€
- å¹³å°æ•°æ®åˆ†å¸ƒ
- æ•°æ®åº“å¥åº·çŠ¶æ€
**ä½¿ç”¨**: `tsx scripts/verify-webhook-data.ts`

---

## âœ… æ¸…ç†å®ŒæˆçŠ¶æ€

### å·²åˆ é™¤çš„é‡å¤è„šæœ¬ (2025-01-15):
1. `test-db-connection.js` âŒ åˆ é™¤
2. `test-db.js` âŒ åˆ é™¤
3. `test-prisma.ts` âŒ åˆ é™¤
4. `test-redis.js` âŒ åˆ é™¤
5. `check-tables.js` âŒ åˆ é™¤
6. `check-user-table.js` âŒ åˆ é™¤

### å½“å‰æ´»è·ƒè„šæœ¬ (9ä¸ª):
1. `db-manager.js` â­ æ•°æ®åº“ç®¡ç†æ ¸å¿ƒ
2. `schema-manager.js` â­ Schemaç®¡ç†ä¸“å®¶
3. `test-connections.ts` â­ è¿æ¥æµ‹è¯•
4. `verify-db-tables.ts` â­ è¡¨ç»“æ„éªŒè¯
5. `final-verification.js` â­ æœ€ç»ˆéªŒè¯
6. `test-db-operations.ts` â­ åŠŸèƒ½æµ‹è¯•
7. `test-create-data.ts` â­ æµ‹è¯•æ•°æ®ç”Ÿæˆ
8. `test-webhook.js` â­ APIæµ‹è¯•
9. `verify-webhook-data.ts` â­ æ•°æ®éªŒè¯

### å½’æ¡£æ–‡ä»¶:
- `archive/add-lock-fields.js` - å†å²æ•°æ®åº“æ›´æ–°è„šæœ¬

### ä¼˜åŒ–å»ºè®®:
1. **ç»Ÿä¸€æŠ€æœ¯æ ˆ**: æ–°è„šæœ¬ä¼˜å…ˆä½¿ç”¨TypeScript
2. **å‘½åè§„èŒƒ**: é‡‡ç”¨åŠ¨è¯+åè¯çš„å‘½åæ–¹å¼
3. **åŠŸèƒ½åˆå¹¶**: å°†ç›¸ä¼¼åŠŸèƒ½çš„è„šæœ¬åˆå¹¶
4. **æ–‡æ¡£å®Œå–„**: æ¯ä¸ªè„šæœ¬æ·»åŠ è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜

---

## ğŸ“ ä½¿ç”¨æœ€ä½³å®è·µ

1. **å¼€å‘ç¯å¢ƒè®¾ç½®**: å…ˆè¿è¡Œ `npm run test:connections` ç¡®ä¿è¿æ¥æ­£å¸¸
2. **Schemaå˜æ›´**: ä½¿ç”¨ `npm run db:deploy` è¿›è¡Œå®Œæ•´éƒ¨ç½²
3. **é—®é¢˜æ’æŸ¥**: ä½¿ç”¨ `node scripts/schema-manager.js health` è¿›è¡Œå¥åº·æ£€æŸ¥
4. **æµ‹è¯•æ•°æ®**: ä½¿ç”¨ `tsx scripts/test-create-data.ts` åˆ›å»ºæµ‹è¯•æ•°æ®
5. **åŠŸèƒ½éªŒè¯**: è¿è¡Œå¯¹åº”çš„æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½æ­£å¸¸